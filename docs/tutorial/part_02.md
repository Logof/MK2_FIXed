# Глава 2 - Tileset

## Примеры
Рассмотрим примеры tileset'ов
Здесь у нас есть набор тайлов из игры Lala lah:

![img.png](https://raw.githubusercontent.com/mojontwins/MK1/master/docs/wiki-img/02_ts_lah.png)

Как видно, первая плитка - это синий фон, который используется на большинстве экранов. 
За ним следует часть платформы, которая также является фоновой плиткой, а затем фланец, представляющий собой плитку типа «платформа» (тип 4). 
Следующий желтый камень - препятствие (тип 8). Затем есть два психоделических растения для украшения фона (тип 0). 
Затем еще один камень (8), кирпичный фон (0), вариант квадратов (0), убивающий шар шипов (тип 1), ящик со звездой (8), 
две тайла, через которые нельзя пройти (тип 8), платформа (тип 4), а для тайла № 15 тип равен 10, потому что мы используем замки, а замки должны быть интерактивным препятствием. 
Затем идет пополение жизни, предмет и ключ, альтернативная плитка для фона и в ряду ниже - тайлы, которые используются для автоматического затенения. 

Посмотрим еще:

![img.png](https://raw.githubusercontent.com/mojontwins/MK1/master/docs/wiki-img/02_ts_d'veel'ng.png)

Это tileset из игры D'Veel'Ng. Он начинается с двух плиток для пола (тип 0), за которыми следуют четыре препятствия (тип 8) - кости, череп, собака и камень, две плитки убийцы и зла (тип 1), которые представляют собой эти уродливые красные черепа.
Еще одно препятствие в виде желтых кирпичей (тип 8), еще один плиточный пол (тип 0), еще одна убивающая вас плитка в виде злого гриба (тип 1), белые кирпичи (тип 8), еще грунт (тип 0) и еще один мешающий череп (тип 8). 
Следующий тайл используется как кнопка, поэтому плитка 14 представляет собой красную коробку с типом 10. У нас также есть ключи, поэтому плитка 15 - это замок (типа 10). 
Затем - объект для пополнения жизни, предмет и ключ, и альтернативный тайл для фона, который раскрашивается случайным образом. 
В нижнем ряду у нас снова есть затененная версия фоновых плиток. 
Обратите внимание, что убивающие плитки выглядят так же в последнем ряду для того, чтобы эти тайлы всегда выглядели хорошо выделенными. 

Давай, еще:

![img.png](https://raw.githubusercontent.com/mojontwins/MK1/master/docs/wiki-img/02_ts_monono.png)

Пришло время илры Monono. Тут все просто: начинается с основного фонового тайла, полностью пустого (тип 0). Продолжаем с шестью препятствиями (тип 8). 
Затем идут еще две фоновые плитки, чтобы украсить фон: окно и щит. Затем есть еще три плитки препятствий (тип 8), несколько проклятых ядов (тип 1), наша типичная металлическая платформа  (тип 4), ящик, который можно толкать (плитка 14, тип 10) и замок (плитка 15, тип 10). 
Второй ряд: пополнение жизни, предмет, ключ, альтернатива. У этого набора тайлов нет автоматической тени.

## Изготовление tileset из 48 тайлов
Как мы уже отмечали, карты, сделанные из 48 тайлов, вдвое больше, чем карты, сделанные из 16. Если принято решение использовать 48 тайлов, то ниже описано, как это сделать.

Во-первых, здесь нет явного различия между разделом карты и специальным разделом - это все вместе. ??? 
Также невозможно добавить автоматическое затенение (у нас нет места для альтернативных вариантов плитки). 

В наборах из 48 плиток мы можем использовать плитки от 0 до 47 для создания экранов, кроме тех, которые соответствуют особым характеристикам: 
плитка 14 для толкаемых, 15 для болтов, 16 для перезарядки, 17 для объектов и 18 для ключей. Если вы не собираетесь их использовать, вы можете выложить свою плитку. (КАК КАРЛ???) 
В наборе из 48 тайлов - 19 не используется в качестве альтернативного фрагмента для фона, поэтому вы можете разместить все, что захотите, в этом пространстве.

В качестве примера, ниже приведен набор тайлов. В этом tileset нет ключей (или замков), поэтому тайлы под номерами 16 (для подзарядки) и 17 (для предметов) используются как «специальные». 
Также нет "толкаемых" тайлов. Все остальные используются для раскрашивания сцены:

![tileset_48](https://raw.githubusercontent.com/mojontwins/MK1/master/docs/wiki-img/02_ts_zcp.png)


## У нас уже есть нарисованный тайлсет. Что теперь?
MTE MK2 использует набор из 256 тайлов для «фиксированных» частей (фон, тексты, маркеры). «Узор» или символ - это не что иное, как изображение размером 8x8 пикселей. 
Из 256 «тайлов» первые 64 будут содержать буквы, цифры и символы, а остальные 192 - будут содержать различные части, используемые для построения нарисованного вами набора тайлов.

Чтобы все биты были такими, какими они нужны, MTE_MK2 имеет конвертер под названием ts2bin, расположенный, как и все утилиты, в каталоге src/linux/utils. 
Для работы ts2bin требуется ДВА файла: один с 64-мя символами шрифта, а другой с tileset.

Если вы не хотите ничего изменять, то первое, что вам нужно сделать, это взять свой набор тайлов (tileset), называть его work.png и сохранить его в /gfx. Затем нужно сделать файл с исходником.

## Шрифты
Файл со шрифтом должен называться font.png и находиться в каталоге gfx. 
Если вы не хотите редактировать build.sh, то файл со шрифтом должен содержать 64 тайла, которые представляют изображения символы с 32 по 95 кодировки ASCII и хранится в виде изображения 256x16, подобного следующему:

![font_example](https://raw.githubusercontent.com/mojontwins/MK1/master/docs/wiki-img/02_base_font.png)

Самый простой способ - переименовать файл base_source.png, включенный в пакет, в качестве шаблона и рисовать на нем или адаптировать существующий шрифт.

## Конвертация и импорт
Утилита ts2bin, включенная в /utils, берет файл со шрифтом и набор тайлов и генерирует двоичный файл со всеми шаблонами в формате, ожидаемом MTE MK2.
Вызов конвертера включен в make.sh.

ts2bin предназначен для вызова из командной строки (или из файла сценария, такого как make.sh). 
Если вы запустите его без параметров из командной строки, ts2bin сообщит вам, какие параметры он ожидает:

```
$ src/utils/ts2bin
ts2bin v0.4 20200119 ~ Usage:

    $ ts2bin font.png/nofont work.png ts.bin [forcezero]

    where:
       * font.png is a 256x16 file with 64 chars ascii 32-95
         (use 'nofont' if you don't want to include a font & gen. 192 tiles)
       * work.png is a 256x48 file with your 16x16 tiles
         (use 'notiles' if you don't want to include a tileset & gen. 64 tiles)
         (use 'blank' if you want to generate a 100% blank placeholder tileset)
       * ts.bin is the output, 2304 bytes bin file.
       * forcezero: adds 0 as 2nd colour when there's only one per 8x8 cell
```
Первый параметр - это имя файла со шрифом или nofont, если вы хотите только преобразовать набор тайлов.

Второй параметр - это имя файла с набором тайлов или notiles, если вы хотите преобразовать только шрифт.

Третий параметр - это имя файла, в который получится на выходе.

Четвертый параметр является необязательным и используется для указания цвета чернил 0-7, который вы хотите использовать, если будет обнаружен какой-либо «узор», представляющий собой сплошной квадрат в качестве второго цвета. Если вы знаете о Спектруме, вы поймете это.

Если открыть make.sh, можно увидеть, что параметры, используемые в вызове для получения шаблонов, соответствуют указанным выше (шрифт называется font.png, а файл с tileset - work.png, и они находятся в gfx). Выходной файл - tileset.bin, а 7 используется как цвет по умолчанию:
```
../utils/ts2bin ../gfx/font.png ../gfx/work.png ../bin/ts.bin forcezero
```
//TODO Вынести в параметры
* Если в игре используются цветные спрайты на полностью черном фоне, то придется указать в этой строке нужный цвет. * 
 
